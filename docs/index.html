<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Solana Tools – SPL Toolkit by Kevin Smits</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Nintendo-stijl font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --bg: #050816;
        --bg-panel: #090f22;
        --bg-panel-alt: #101632;
        --accent: #00e0ff;
        --accent-soft: rgba(0, 224, 255, 0.16);
        --accent-strong: #00f59d;
        --border: #242b4a;
        --text: #f5f7ff;
        --muted: #9ca6d9;
        --danger: #ff4b81;
        --success: #4bffb1;
        --warning: #ffd166;
      }

      body {
        background: radial-gradient(circle at top, #101633 0, #050816 55%);
        color: var(--text);
        font-family: "Press Start 2P", system-ui, -apple-system,
          BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 10px;
        line-height: 1.6;
        padding: 16px;
      }

      .page {
        max-width: 1220px;
        margin: 0 auto;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        gap: 12px;
      }

      header h1 {
        font-size: 18px;
        letter-spacing: 3px;
        text-transform: uppercase;
        text-shadow: 0 0 6px rgba(0, 224, 255, 0.5);
      }

      header .badge {
        font-size: 8px;
        padding: 4px 8px;
        border-radius: 999px;
        background: var(--accent-soft);
        border: 1px solid var(--accent);
        color: var(--accent);
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      header p {
        margin-top: 4px;
        font-size: 8px;
        color: var(--muted);
        max-width: 420px;
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
        gap: 16px;
      }

      .panel {
        border-radius: 12px;
        border: 1px solid var(--border);
        background: radial-gradient(
          circle at top left,
          #131a3d 0,
          #090f22 40%,
          #050816 100%
        );
        padding: 12px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
        position: relative;
        overflow: hidden;
      }

      .panel::before {
        content: "";
        position: absolute;
        inset: -60%;
        background: radial-gradient(
            circle at 0 0,
            rgba(0, 224, 255, 0.12) 0,
            transparent 50%
          ),
          radial-gradient(
            circle at 100% 100%,
            rgba(0, 245, 157, 0.08) 0,
            transparent 55%
          );
        opacity: 0.8;
        pointer-events: none;
      }

      .panel-content {
        position: relative;
        z-index: 1;
      }

      .panel-title {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .panel-title span {
        color: var(--muted);
        font-size: 8px;
      }

      .pill {
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid var(--border);
        font-size: 8px;
        text-transform: uppercase;
      }

      .pill.green {
        border-color: var(--success);
        color: var(--success);
      }

      .pill.red {
        border-color: var(--danger);
        color: var(--danger);
      }

      .pill.yellow {
        border-color: var(--warning);
        color: var(--warning);
      }

      /* Inputs */

      .inputs-grid {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 8px;
        margin-bottom: 8px;
      }

      .field-label {
        font-size: 8px;
        color: var(--muted);
        margin-bottom: 2px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .field {
        display: flex;
        flex-direction: column;
      }

      input[type="text"] {
        background: rgba(3, 8, 30, 0.96);
        border-radius: 8px;
        border: 1px solid var(--border);
        padding: 7px 8px;
        color: var(--text);
        font-family: inherit;
        font-size: 9px;
        outline: none;
      }

      input[type="text"]:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(0, 224, 255, 0.35);
      }

      .button-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 6px;
      }

      button {
        border-radius: 999px;
        border: 1px solid var(--border);
        background: linear-gradient(145deg, #141b3d, #090f22);
        color: var(--text);
        padding: 6px 10px;
        font-family: inherit;
        font-size: 8px;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        transition: 0.12s ease-out;
      }

      button span.dot {
        width: 4px;
        height: 4px;
        border-radius: 999px;
        background: var(--muted);
      }

      button.primary {
        border-color: var(--accent);
        background: linear-gradient(145deg, #00e0ff, #00f59d);
        color: #050816;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.6);
      }

      button:active {
        transform: translateY(0);
        box-shadow: none;
      }

      button.secondary {
        background: rgba(6, 12, 38, 0.9);
      }

      .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 4px;
        font-size: 8px;
        color: var(--muted);
        gap: 8px;
      }

      .status-left {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .status-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: var(--danger);
        box-shadow: 0 0 6px rgba(255, 75, 129, 0.7);
      }

      .status-dot.ok {
        background: var(--success);
        box-shadow: 0 0 6px rgba(75, 255, 177, 0.7);
      }

      .status-dot.idle {
        background: var(--muted);
        box-shadow: none;
      }

      .status-label {
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .status-right {
        max-width: 260px;
        text-align: right;
      }

      /* Output console */

      .output {
        margin-top: 10px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: radial-gradient(circle at top, #131a3d 0, #050816 60%);
        padding: 12px 10px 10px 10px; /* extra top-padding */
        min-height: 170px;
        font-size: 9px;
        overflow: auto;
        position: relative;
      }

      .output::before {
        content: "▶";
        position: absolute;
        left: 8px;
        top: 6px;
        font-size: 8px;
        color: var(--accent);
        opacity: 0.7;
        pointer-events: none;
      }

      .output-inner {
        padding-left: 16px;
        white-space: normal;
        overflow-wrap: anywhere; /* lange mints/URLs netjes afbreken */
      }

      .output h3 {
        font-size: 9px;
        margin-bottom: 6px;
        color: var(--accent-strong);
      }

      .output p {
        margin-bottom: 4px;
      }

      .output ul,
      .output ol {
        margin-left: 14px;
        margin-bottom: 6px;
      }

      .output li {
        margin-bottom: 3px;
      }

      .output small {
        font-size: 8px;
        color: var(--muted);
      }

      .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 6px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 4px;
        font-size: 8px;
      }

      th,
      td {
        padding: 3px 4px;
        border-bottom: 1px solid rgba(50, 60, 100, 0.7);
        text-align: left;
        overflow-wrap: anywhere; /* addresses breken i.p.v. overlappen */
      }

      th {
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--muted);
        font-weight: normal;
      }

      tr:nth-child(even) td {
        background: rgba(8, 14, 40, 0.7);
      }

      /* Right column */

      .tools-list {
        font-size: 8px;
        color: var(--muted);
      }

      .tools-list ul {
        margin-left: 14px;
        margin-top: 4px;
      }

      .tools-list li {
        margin-bottom: 3px;
      }

      .api-contract {
        font-size: 8px;
        margin-top: 6px;
      }

      .api-contract code {
        font-family: "Press Start 2P", monospace;
        background: rgba(3, 8, 30, 0.9);
        padding: 2px 4px;
        border-radius: 4px;
        border: 1px solid var(--border);
        display: block;
        margin-bottom: 2px;
        overflow-x: auto;
      }

      .base-url-box {
        margin-top: 8px;
      }

      .base-url-box input {
        width: 100%;
      }

      .hint {
        margin-top: 4px;
        font-size: 8px;
        color: var(--muted);
      }

      @media (max-width: 900px) {
        .layout {
          grid-template-columns: minmax(0, 1fr);
        }
      }
    </style>
  </head>

  <body>
    <div class="page">
      <header>
        <div>
          <h1>SOLANA TOOLS</h1>
          <p>SPL on-chain insights in one Web2 dashboard. Read-only, no keys.</p>
        </div>
        <div>
          <div class="badge">
            <span>BY KEVIN SMITS</span>
          </div>
        </div>
      </header>

      <div class="layout">
        <!-- LEFT: INPUT + OUTPUT ------------------------------------------------>
        <section class="panel">
          <div class="panel-content">
            <div class="panel-title">
              <div>WALLET &amp; TOKEN INPUT</div>
              <span>Fill once, then click any tool</span>
            </div>

            <div class="inputs-grid">
              <div class="field">
                <label class="field-label" for="walletAddress">
                  Wallet address
                </label>
                <input
                  id="walletAddress"
                  type="text"
                  placeholder="Enter Solana wallet (public key)"
                />
              </div>
              <div class="field">
                <label class="field-label" for="tokenMint">
                  Token mint
                </label>
                <input
                  id="tokenMint"
                  type="text"
                  placeholder="Enter SPL token mint (default: CBS)"
                />
              </div>
            </div>

            <div class="button-row">
              <button id="btnWallet" class="secondary">
                <span class="dot"></span> Wallet info
              </button>
              <button id="btnToken" class="secondary">
                <span class="dot"></span> Token info
              </button>
              <button id="btnHolders" class="secondary">
                <span class="dot"></span> Holder info
              </button>
              <button id="btnDex" class="secondary">
                <span class="dot"></span> DEX metrics
              </button>
              <button id="btnWhale" class="secondary">
                <span class="dot"></span> Whale tracker
              </button>
              <button id="btnSafety" class="secondary">
                <span class="dot"></span> Safety check
              </button>
              <button id="btnClear" class="secondary">✕ Clear output</button>
            </div>

            <div class="status-bar">
              <div class="status-left">
                <div id="statusDot" class="status-dot idle"></div>
                <div id="statusText" class="status-label">idle</div>
              </div>
              <div class="status-right" id="statusUrl">
                Backend base URL: not configured
              </div>
            </div>

            <div class="output" id="output">
              <div class="output-inner" id="outputInner">
                <p>
                  Ready.<br />
                  1) Paste your wallet + mint.<br />
                  2) Click a tool above to query your backend API.
                </p>
              </div>
            </div>
          </div>
        </section>

        <!-- RIGHT: DOCS ---------------------------------------------------------->
        <section class="panel">
          <div class="panel-content">
            <div class="panel-title">
              <div>AVAILABLE TOOLS</div>
              <span>Mapped to solana-tools repo</span>
            </div>

            <div class="tools-list">
              <ul>
                <li>
                  <strong>wallet-info</strong> → basic wallet balance + SPL list
                </li>
                <li>
                  <strong>token-info</strong> → SPL mint metadata, decimals,
                  supply
                </li>
                <li>
                  <strong>cbs-metrics</strong> → DexScreener Raydium prices
                  &amp; liquidity
                </li>
                <li>
                  <strong>holder-info</strong> → snapshot of SPL holders + top
                  distribution
                </li>
                <li>
                  <strong>token-safety-check</strong> → heuristic risk check
                  for SPL tokens
                </li>
                <li>
                  <strong>whale-tracker</strong> → designed for large holder
                  movements (API coming next)
                </li>
              </ul>
            </div>

            <div class="panel-title" style="margin-top: 10px">
              <div>EXPECTED BACKEND ENDPOINTS</div>
              <span class="pill">API contract</span>
            </div>

            <div class="api-contract">
              <code>GET /api/wallet-info?address=...</code>
              <code>GET /api/token-info?mint=...</code>
              <code>GET /api/cbs-metrics?mint=...</code>
              <code>GET /api/holder-info?mint=...</code>
              <code>GET /api/token-safety-check?mint=...</code>
              <!-- whale-tracker intentionally not wired yet -->
            </div>

            <div class="panel-title" style="margin-top: 10px">
              <div>BACKEND BASE URL</div>
              <span class="pill">Config</span>
            </div>

            <div class="base-url-box">
              <div class="field">
                <label class="field-label" for="apiBaseUrl">
                  API base URL
                </label>
                <input
                  id="apiBaseUrl"
                  type="text"
                  value="https://solana-tools-api.onrender.com"
                />
              </div>
              <div class="hint">
                Host your Node/TypeScript tools (solana-tools) behind a small
                API and point this UI to it. All calls are client-side.
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script>
      const apiBaseUrlInput = document.getElementById("apiBaseUrl");
      const walletInput = document.getElementById("walletAddress");
      const mintInput = document.getElementById("tokenMint");
      const outputInner = document.getElementById("outputInner");
      const statusDot = document.getElementById("statusDot");
      const statusText = document.getElementById("statusText");
      const statusUrl = document.getElementById("statusUrl");

      // Buttons
      document
        .getElementById("btnWallet")
        .addEventListener("click", () => handleToolClick("wallet"));
      document
        .getElementById("btnToken")
        .addEventListener("click", () => handleToolClick("token"));
      document
        .getElementById("btnHolders")
        .addEventListener("click", () => handleToolClick("holders"));
      document
        .getElementById("btnDex")
        .addEventListener("click", () => handleToolClick("dex"));
      document
        .getElementById("btnWhale")
        .addEventListener("click", () => handleToolClick("whale"));
      document
        .getElementById("btnSafety")
        .addEventListener("click", () => handleToolClick("safety"));
      document.getElementById("btnClear").addEventListener("click", () => {
        outputInner.innerHTML =
          "<p>Console cleared. Choose a tool to run a new query.</p>";
        setStatus("idle", "idle");
      });

      function getBaseUrl() {
        let url = apiBaseUrlInput.value.trim();
        if (url.endsWith("/")) url = url.slice(0, -1);
        statusUrl.textContent = "Backend base URL: " + (url || "not set");
        return url;
      }

      function setStatus(message, level) {
        statusText.textContent = message.toUpperCase();
        statusDot.classList.remove("ok", "idle");
        if (level === "ok") {
          statusDot.classList.add("ok");
        } else if (level === "idle") {
          statusDot.classList.add("idle");
        } else {
          // error
          statusDot.classList.remove("ok", "idle");
        }
      }

      function requireMint() {
        let mint = mintInput.value.trim();
        if (!mint) {
          // default CBS mint
          mint = "B9z8cEWFmc7LvQtjKsaLoKqW5MJmGRCWqs1DPKupCfkk";
          mintInput.value = mint;
        }
        return mint;
      }

      async function handleToolClick(tool) {
        const baseUrl = getBaseUrl();
        if (!baseUrl) {
          alert("Set your API base URL first.");
          return;
        }

        try {
          setStatus("working", "error");

          if (tool === "wallet") {
            const addr = walletInput.value.trim();
            if (!addr) {
              alert("Fill in a wallet address first.");
              return;
            }
            const url =
              baseUrl +
              "/api/wallet-info?address=" +
              encodeURIComponent(addr);
            const data = await fetchJson(url);
            renderWalletInfo(data);
            setStatus("wallet info ok", "ok");
          } else if (tool === "token") {
            const mint = requireMint();
            const url =
              baseUrl + "/api/token-info?mint=" + encodeURIComponent(mint);
            const data = await fetchJson(url);
            renderTokenInfo(data);
            setStatus("token info ok", "ok");
          } else if (tool === "holders") {
            const mint = requireMint();
            const url =
              baseUrl + "/api/holder-info?mint=" + encodeURIComponent(mint);
            const data = await fetchJson(url);
            renderHolderInfo(data);
            setStatus("holder info ok", "ok");
          } else if (tool === "dex") {
            const mint = requireMint();
            const url =
              baseUrl + "/api/cbs-metrics?mint=" + encodeURIComponent(mint);
            const data = await fetchJson(url);
            renderDexMetrics(data);
            setStatus("dex metrics ok", "ok");
          } else if (tool === "safety") {
            const mint = requireMint();
            const url =
              baseUrl +
              "/api/token-safety-check?mint=" +
              encodeURIComponent(mint);
            const data = await fetchJson(url);
            renderSafetyCheck(data);
            setStatus("safety check ok", "ok");
          } else if (tool === "whale") {
            renderWhaleComingSoon();
            setStatus("whale tracker (ui only)", "ok");
          }
        } catch (err) {
          console.error(err);
          outputInner.innerHTML =
            "<h3>Request failed</h3><p>" +
            (err && err.message ? err.message : String(err)) +
            "</p>";
          setStatus("error", "error");
        }
      }

      async function fetchJson(url) {
        statusUrl.textContent = "Calling: " + url;
        const res = await fetch(url);
        if (!res.ok) {
          let msg = res.status + " " + res.statusText;
          try {
            const text = await res.text();
            msg += " – " + text;
          } catch (_) {}
          throw new Error(msg);
        }
        return res.json();
      }

      // RENDER FUNCTIONS ------------------------------------------------------

      function renderWalletInfo(data) {
        const tokens = Array.isArray(data.tokens) ? data.tokens : [];

        let html = "<h3>Wallet overview</h3>";
        html += "<div class='grid-2'>";
        html += "<div>";
        html +=
          "<p><strong>Address:</strong><br />" +
          escapeHtml(data.address) +
          "</p>";
        html +=
          "<p><strong>SOL balance:</strong> " +
          (data.sol != null ? data.sol.toFixed(6) : "n/a") +
          " SOL</p>";
        html +=
          "<p><strong>Lamports:</strong> " +
          (data.lamports != null ? data.lamports.toString() : "n/a") +
          "</p>";
        html += "</div>";

        html += "<div>";
        html +=
          "<p><strong>RPC:</strong><br />" +
          escapeHtml(data.rpcUrl || "") +
          "</p>";
        html +=
          "<p><strong>SPL tokens found:</strong> " + tokens.length + "</p>";
        html +=
          "<small>Only non-zero SPL balances are shown. Names/decimals come from on-chain token accounts.</small>";
        html += "</div>";
        html += "</div>";

        if (tokens.length > 0) {
          html += "<h3 style='margin-top:8px'>SPL token balances</h3>";
          html += "<table><thead><tr>";
          html += "<th>#</th><th>Mint</th><th>Amount</th><th>Decimals</th>";
          html += "</tr></thead><tbody>";

          tokens.forEach((t, i) => {
            html += "<tr>";
            html += "<td>" + (i + 1) + "</td>";
            html += "<td>" + escapeHtml(t.mint || "") + "</td>";
            html +=
              "<td>" +
              (t.uiAmount != null
                ? Number(t.uiAmount).toLocaleString()
                : "0") +
              "</td>";
            html += "<td>" + (t.decimals != null ? t.decimals : "?") + "</td>";
            html += "</tr>";
          });

          html += "</tbody></table>";
        } else {
          html +=
            "<p style='margin-top:6px'>No SPL token balances detected.</p>";
        }

        outputInner.innerHTML = html;
      }

      function renderTokenInfo(data) {
        let html = "<h3>Token mint info</h3>";
        html += "<div class='grid-2'>";
        html += "<div>";
        html += "<p><strong>Mint:</strong><br />" + escapeHtml(data.mint) + "</p>";
        html += "<p><strong>Decimals:</strong> " + data.decimals + "</p>";
        html +=
          "<p><strong>Supply:</strong> " +
          Number(data.supply).toLocaleString() +
          "</p>";
        html += "</div>";

        html += "<div>";
        html +=
          "<p><strong>Mint authority:</strong><br />" +
          (data.mintAuthority ||
            "<span style='color:#4bffb1'>None (immutable)</span>") +
          "</p>";
        html +=
          "<p><strong>Freeze authority:</strong><br />" +
          (data.freezeAuthority ||
            "<span style='color:#4bffb1'>None (no freeze)</span>") +
          "</p>";
        html +=
          "<p><strong>Initialized:</strong> " +
          (data.isInitialized ? "Yes" : "No") +
          "</p>";
        html += "</div>";
        html += "</div>";

        outputInner.innerHTML = html;
      }

      function renderDexMetrics(data) {
        const ray = Array.isArray(data.raydium) ? data.raydium : [];
        const others = Array.isArray(data.others) ? data.others : [];

        let html = "<h3>DEX metrics (DexScreener)</h3>";
        html += "<div class='grid-2'>";
        html += "<div>";
        html += "<p><strong>Mint:</strong><br />" + escapeHtml(data.mint) + "</p>";
        html +=
          "<p><strong>Total pools:</strong> " + (data.totalPools || 0) + "</p>";
        html +=
          "<p><strong>Raydium pools:</strong> " +
          (data.raydiumCount || 0) +
          "</p>";
        html +=
          "<p><strong>Other DEX pools:</strong> " +
          (data.otherDexCount || 0) +
          "</p>";
        html += "</div>";

        html += "<div>";
        html +=
          "<p><strong>Raydium total liquidity:</strong><br />$" +
          (data.totalLiquidityUsd != null
            ? data.totalLiquidityUsd.toFixed(2)
            : "0.00") +
          "</p>";
        html +=
          "<small>Liquidity and prices are read from DexScreener's public API.</small>";
        html += "</div>";
        html += "</div>";

        if (ray.length > 0) {
          html += "<h3 style='margin-top:8px'>Raydium pools</h3>";
          html += "<table><thead><tr>";
          html += "<th>#</th><th>Pair</th><th>Price (USD)</th><th>Liquidity</th>";
          html += "</tr></thead><tbody>";
          ray.forEach((p, i) => {
            html += "<tr>";
            html += "<td>" + (i + 1) + "</td>";
            const pair =
              (p.baseToken && p.baseToken.symbol) +
              " / " +
              (p.quoteToken && p.quoteToken.symbol);
            html += "<td>" + escapeHtml(pair) + "</td>";
            html += "<td>$" + (p.priceUsd || "0.000000") + "</td>";
            html +=
              "<td>$" +
              (p.liquidityUsd != null ? p.liquidityUsd.toFixed(2) : "0.00") +
              "</td>";
            html += "</tr>";
          });
          html += "</tbody></table>";
        }

        if (others.length > 0) {
          html +=
            "<p style='margin-top:6px'><strong>Other DEX pools:</strong> " +
            others.length +
            " (not listed individually here).</p>";
        }

        outputInner.innerHTML = html;
      }

      function renderHolderInfo(data) {
        const holders = Array.isArray(data.holders) ? data.holders : [];
        const top20 = holders.slice(0, 20);

        let html = "<h3>Holder distribution</h3>";
        html += "<div class='grid-2'>";
        html += "<div>";
        html += "<p><strong>Mint:</strong><br />" + escapeHtml(data.mint) + "</p>";
        html +=
          "<p><strong>Total holders:</strong> " +
          (data.totalHolders != null ? data.totalHolders : "?") +
          "</p>";
        html +=
          "<p><strong>Snapshot holders:</strong> " +
          (data.filteredCount != null ? data.filteredCount : "?") +
          "</p>";
        html += "</div>";

        const c = data.concentration || {};
        html += "<div>";
        html +=
          "<p><strong>Top 1:</strong> " +
          (c.top1 != null ? c.top1.toFixed(2) : "0.00") +
          "% of supply</p>";
        html +=
          "<p><strong>Top 5:</strong> " +
          (c.top5 != null ? c.top5.toFixed(2) : "0.00") +
          "% of supply</p>";
        html +=
          "<p><strong>Top 10:</strong> " +
          (c.top10 != null ? c.top10.toFixed(2) : "0.00") +
          "% of supply</p>";
        html += "</div>";
        html += "</div>";

        if (top20.length > 0) {
          html += "<h3 style='margin-top:8px'>Top holders (first 20)</h3>";
          html += "<table><thead><tr>";
          html += "<th>#</th><th>Owner</th><th>Amount</th><th>% of supply</th>";
          html += "</tr></thead><tbody>";

          top20.forEach((h, i) => {
            html += "<tr>";
            html += "<td>" + (i + 1) + "</td>";
            html += "<td>" + escapeHtml(h.owner) + "</td>";
            html +=
              "<td>" +
              (h.uiAmount != null
                ? Number(h.uiAmount).toLocaleString(undefined, {
                    maximumFractionDigits: 6,
                  })
                : "0") +
              "</td>";
            html +=
              "<td>" +
              (h.percentageOfSupply != null
                ? h.percentageOfSupply.toFixed(4)
                : "0.0000") +
              "%</td>";
            html += "</tr>";
          });

          html += "</tbody></table>";
        } else {
          html +=
            "<p style='margin-top:6px'>No holders found in this snapshot.</p>";
        }

        if (data.note) {
          html +=
            "<p style='margin-top:6px'><small>" +
            escapeHtml(data.note) +
            "</small></p>";
        }

        outputInner.innerHTML = html;
      }

      function renderSafetyCheck(data) {
        const safety = data.safety || {};
        const reasons = Array.isArray(safety.reasons) ? safety.reasons : [];
        const risk = safety.riskLevel || "unknown";

        let pillClass = "yellow";
        if (risk === "low") pillClass = "green";
        if (risk === "high") pillClass = "red";

        let html = "<h3>Token safety check</h3>";
        html += "<div class='grid-2'>";
        html += "<div>";
        html += "<p><strong>Mint:</strong><br />" + escapeHtml(data.mint) + "</p>";
        html +=
          "<p><strong>Risk level:</strong> <span class='pill " +
          pillClass +
          "'>" +
          risk.toUpperCase() +
          "</span></p>";
        html += "</div>";

        html += "<div>";
        html +=
          "<p><strong>Immutable mint:</strong> " +
          (safety.immutableMint ? "Yes" : "No") +
          "</p>";
        html +=
          "<p><strong>Freeze authority set:</strong> " +
          (safety.canFreeze ? "Yes" : "No") +
          "</p>";
        html +=
          "<p><strong>Has Raydium pools:</strong> " +
          (safety.hasRaydiumPool ? "Yes" : "No") +
          "</p>";
        html += "</div>";
        html += "</div>";

        if (reasons.length > 0) {
          html += "<h3 style='margin-top:8px'>Why this rating?</h3>";
          html += "<ul>";
          reasons.forEach((r) => {
            html += "<li>" + escapeHtml(r) + "</li>";
          });
          html += "</ul>";
        }

        html +=
          "<p style='margin-top:6px'><small>" +
          escapeHtml(
            data.disclaimer ||
              "Heuristic only. Not financial advice. Always DYOR."
          ) +
          "</small></p>";

        outputInner.innerHTML = html;
      }

      function renderWhaleComingSoon() {
        const html =
          "<h3>Whale tracker</h3>" +
          "<p>This UI button is ready, but the <code>/api/whale-tracker</code> endpoint isn't wired on your backend yet.</p>" +
          "<p style='margin-top:4px'>You can implement it later in your <strong>solana-tools-api</strong> project (for example using your <em>whale-tracker</em> package) and keep this page as-is.</p>";
        outputInner.innerHTML = html;
      }

      function escapeHtml(str) {
        if (str == null) return "";
        return String(str)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      // Init
      getBaseUrl();
    </script>
  </body>
</html>
