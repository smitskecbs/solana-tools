<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Whale Tracker ‚Äì solana-tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Neon Solana whale & holder movement dashboard for SPL tokens. Built on solana-tools by Kevin Smits (@smitskecbs)."
  />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Baloo+2:wght@500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      color-scheme: dark;
      --bg: #050016;
      --grid-line: rgba(148, 163, 184, 0.18);

      --purple: #8b5cf6;
      --pink: #ec4899;
      --cyan: #22d3ee;
      --solana1: #14f195;
      --solana2: #9945ff;

      --card-bg: rgba(15, 23, 42, 0.98);
      --card-border: rgba(148, 163, 184, 0.8);

      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --ok: #22c55e;
      --warn: #facc15;
      --danger: #fb7185;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Space Grotesk", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, #4c1d95 0, #050016 45%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 18px;
      overflow-x: hidden;
      position: relative;
    }

    /* neon grid */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image:
        linear-gradient(to right, var(--grid-line) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid-line) 1px, transparent 1px);
      background-size: 42px 42px;
      opacity: 0.6;
      z-index: -2;
    }

    body::after {
      content: "";
      position: fixed;
      inset: -20%;
      pointer-events: none;
      background:
        radial-gradient(circle at 12% 20%, rgba(236, 72, 153, 0.28), transparent 65%),
        radial-gradient(circle at 82% 75%, rgba(34, 211, 238, 0.25), transparent 60%),
        radial-gradient(circle at 50% 120%, rgba(20, 241, 149, 0.22), transparent 65%);
      mix-blend-mode: screen;
      z-index: -1;
    }

    .page {
      width: 100%;
      max-width: 1180px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .shell {
      border-radius: 28px;
      padding: 20px 18px 14px;
      background:
        radial-gradient(circle at top left, rgba(236, 72, 153, 0.22), transparent 60%),
        radial-gradient(circle at bottom right, rgba(34, 211, 238, 0.16), transparent 60%),
        rgba(10, 16, 32, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow:
        0 32px 90px rgba(0, 0, 0, 0.95),
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 0 38px rgba(139, 92, 246, 0.7);
      position: relative;
      overflow: hidden;
    }

    .shell::after {
      content: "";
      position: absolute;
      top: 14px;
      right: 26px;
      width: 138px;
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--solana1), var(--solana2), var(--cyan));
      box-shadow:
        0 0 18px rgba(20, 241, 149, 0.8),
        0 0 22px rgba(153, 69, 255, 0.9);
      opacity: 0.85;
    }

    /* header */

    .header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      margin-bottom: 10px;
    }

    @media (max-width: 720px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .logo-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-bubble {
      width: 56px;
      height: 56px;
      border-radius: 22px;
      background:
        conic-gradient(from 210deg,
          #ec4899,
          #8b5cf6,
          #22d3ee,
          #14f195,
          #facc15,
          #ec4899);
      box-shadow:
        0 0 0 3px rgba(15, 23, 42, 0.9),
        0 0 40px rgba(236, 72, 153, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }

    .title-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-main h1 {
      margin: 0;
      font-family: "Baloo 2", system-ui;
      font-size: 28px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #f9fafb;
      text-shadow:
        0 0 18px rgba(56, 189, 248, 0.9),
        0 0 30px rgba(236, 72, 153, 0.9);
    }

    .subtitle-text {
      font-size: 13px;
      color: var(--text-muted);
      max-width: 540px;
    }

    .subtitle-text strong {
      color: var(--pink);
    }

    .subtitle-text a {
      color: var(--cyan);
      text-decoration: none;
    }

    .subtitle-text a:hover {
      text-decoration: underline;
    }

    .hero-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      text-align: right;
      font-size: 11px;
      color: #cbd5f5;
    }

    .hero-badge {
      padding: 7px 13px;
      border-radius: 999px;
      background: radial-gradient(circle at top left, #22c55e, #14f195);
      color: #022c22;
      font-family: "Baloo 2", system-ui;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow:
        0 16px 42px rgba(20, 241, 149, 0.92),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .hero-badge span.emoji {
      font-size: 18px;
    }

    .hero-text-small {
      opacity: 0.9;
      max-width: 220px;
    }

    /* layout */

    .main-grid {
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 14px;
      margin-top: 6px;
    }

    @media (max-width: 900px) {
      .main-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      position: relative;
      border-radius: 22px;
      border: 1px solid var(--card-border);
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.98), #020617);
      box-shadow:
        0 20px 55px rgba(0, 0, 0, 1),
        0 0 0 1px rgba(15, 23, 42, 1);
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -20%;
      background:
        radial-gradient(circle at top left, rgba(236, 72, 153, 0.2), transparent 60%),
        radial-gradient(circle at bottom right, rgba(34, 211, 238, 0.2), transparent 55%);
      opacity: 0.85;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
      padding: 13px 14px 11px;
    }

    .card-headerline {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 14px 6px;
      border-bottom: 1px solid rgba(51, 65, 85, 0.9);
    }

    .card-headerline::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        90deg,
        rgba(15, 23, 42, 0.9),
        rgba(139, 92, 246, 0.4),
        rgba(15, 23, 42, 0.9)
      );
      opacity: 0.7;
      z-index: -1;
    }

    .card-title {
      font-family: "Baloo 2", system-ui;
      font-size: 14px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #f9fafb;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .card-pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.85);
      color: #e5e7eb;
      background: radial-gradient(circle at top left, #0f172a, #020617);
      font-family: "Space Grotesk", system-ui;
      white-space: nowrap;
    }

    /* input side */

    .field-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #9ca3af;
      margin-bottom: 6px;
      font-family: "Baloo 2", system-ui;
    }

    textarea {
      width: 100%;
      min-height: 180px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: radial-gradient(circle at top left, #020617, #020617);
      color: #e5e7eb;
      padding: 10px 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      resize: vertical;
      outline: none;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.95),
        0 10px 26px rgba(15, 23, 42, 0.95);
    }

    textarea::placeholder {
      color: #6b7280;
    }

    textarea:focus {
      border-color: var(--pink);
      box-shadow:
        0 0 0 1px rgba(236, 72, 153, 0.9),
        0 0 30px rgba(236, 72, 153, 0.9);
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    @keyframes pulse-glow {
      0% {
        box-shadow:
          0 16px 45px rgba(20, 241, 149, 0.8),
          0 0 0 1px rgba(15, 23, 42, 1);
      }
      50% {
        box-shadow:
          0 18px 55px rgba(56, 189, 248, 0.9),
          0 0 0 1px rgba(15, 23, 42, 1);
      }
      100% {
        box-shadow:
          0 16px 45px rgba(20, 241, 149, 0.8),
          0 0 0 1px rgba(15, 23, 42, 1);
      }
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      padding: 9px 18px;
      font-family: "Baloo 2", system-ui;
      font-size: 12px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #14f195, #22d3ee, #8b5cf6);
      color: #020617;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      animation: pulse-glow 2.1s infinite ease-in-out;
      transition:
        transform 120ms ease-out,
        filter 120ms ease-out;
    }

    .btn-primary span.icon {
      font-size: 18px;
    }

    .btn-primary:hover {
      filter: brightness(1.06);
      transform: translateY(-1px);
    }

    .btn-primary:active {
      transform: translateY(0) scale(0.98);
      animation: none;
    }

    .btn-primary:disabled {
      opacity: 0.45;
      cursor: default;
      animation: none;
    }

    .status-line {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #e5e7eb;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 1);
      background: #6b7280;
      box-shadow: 0 0 0 0 rgba(148, 163, 184, 0.7);
      transition: all 130ms ease-out;
    }

    .status-dot.ok {
      background: #22c55e;
      box-shadow: 0 0 14px rgba(34, 197, 94, 0.9);
    }

    .status-dot.error {
      background: #fb7185;
      box-shadow: 0 0 14px rgba(248, 113, 113, 0.9);
    }

    .log-line {
      margin-top: 4px;
      font-size: 11px;
      color: #9ca3af;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .log-line.error {
      color: #fb7185;
    }

    /* result side */

    .snapshot-meta {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .snapshot-meta strong {
      color: #e5e7eb;
    }

    .section-title {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #a5b4fc;
      margin: 6px 0 4px;
      font-family: "Baloo 2", system-ui;
    }

    .table-wrap {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.85);
      background: radial-gradient(circle at top left, #020617, #020617);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.9);
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    thead {
      background: rgba(15, 23, 42, 0.98);
    }

    th, td {
      padding: 6px 8px;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      color: #e5e7eb;
      border-bottom: 1px solid rgba(55, 65, 81, 0.9);
      font-family: "Baloo 2", system-ui;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 10px;
    }

    tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.96);
    }

    tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.9);
    }

    td {
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      color: #e5e7eb;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    .addr {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      font-family: "Baloo 2", system-ui;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .badge.new {
      background: rgba(22, 163, 74, 0.28);
      color: #bbf7d0;
      border: 1px solid #22c55e;
    }

    .badge.gone {
      background: rgba(220, 38, 38, 0.45);
      color: #fee2e2;
      border: 1px solid #ef4444;
    }

    .badge.up {
      background: rgba(56, 189, 248, 0.26);
      color: #e0f2fe;
      border: 1px solid #22d3ee;
    }

    .badge.down {
      background: rgba(234, 179, 8, 0.3);
      color: #fef9c3;
      border: 1px solid #eab308;
    }

    .badge.flat {
      background: rgba(75, 85, 99, 0.5);
      color: #e5e7eb;
      border: 1px solid rgba(156, 163, 175, 0.9);
    }

    .muted {
      color: #6b7280;
    }

    /* footer */

    .footer {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px dashed rgba(55, 65, 81, 0.9);
      font-size: 11px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      color: #9ca3af;
      align-items: center;
    }

    .footer a {
      color: var(--cyan);
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    .footer-right {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .tg-pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.95);
      background: radial-gradient(circle at top left, #020617, #020617);
      color: #bae6fd;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      font-family: "Baloo 2", system-ui;
    }

    .tg-pill span.icon {
      font-size: 14px;
    }

    @media (max-width: 640px) {
      body {
        padding: 12px;
      }
      .shell {
        padding: 16px 12px 11px;
      }
      .footer {
        flex-direction: column;
        align-items: flex-start;
      }
      table {
        font-size: 10px;
      }
      th, td {
        padding: 4px 6px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <header class="header">
        <div class="title-block">
          <div class="logo-row">
            <div class="logo-bubble">üêã</div>
            <div class="title-main">
              <h1>WHALE TRACKER</h1>
              <p class="subtitle-text">
                Paste JSON output from the
                <strong>@smitskecbs/whale-tracker</strong> CLI and get a neon
                dashboard of top holders and whale movements for any SPL mint.
                All built on
                <a href="https://github.com/smitskecbs/solana-tools" target="_blank" rel="noreferrer">
                  solana-tools
                </a>.
              </p>
            </div>
          </div>
        </div>

        <div class="hero-right">
          <div class="hero-badge">
            <span class="emoji">üìà</span>
            <span>Holder intel ‚Äì no wallet connect</span>
          </div>
          <div class="hero-text-small">
            Use snapshots + diffs to see who‚Äôs really staying, exiting or aping in.
          </div>
        </div>
      </header>

      <main class="main-grid">
        <!-- LEFT: JSON input -->
        <section class="card">
          <div class="card-headerline">
            <div class="card-title">JSON INPUT</div>
            <div class="card-pill">From @smitskecbs/whale-tracker</div>
          </div>
          <div class="card-inner">
            <div class="field-label">Snapshot / diff JSON</div>
            <textarea
              id="json-input"
              spellcheck="false"
              placeholder='Paste the JSON from snapshots/cbs-YYYY-MM-DD.json here.
It can contain just {"snapshot": ...} or {"snapshot": ..., "diff": ...}.'
            ></textarea>
            <div class="hint">
              JSON is never sent anywhere ‚Äì everything runs in your browser.
            </div>

            <div class="controls-row">
              <button id="parse-button" class="btn-primary">
                <span class="icon">‚ö°</span>
                Render dashboard
              </button>

              <div class="status-line">
                <span id="status-dot" class="status-dot"></span>
                <span id="status-text">Idle. Paste JSON from your CLI output.</span>
              </div>
            </div>

            <div id="log" class="log-line"></div>
          </div>
        </section>

        <!-- RIGHT: results -->
        <section class="card">
          <div class="card-headerline">
            <div class="card-title">RESULT</div>
            <div class="card-pill">Top holders & whale moves</div>
          </div>
          <div class="card-inner">
            <div id="snapshot-meta" class="snapshot-meta muted">
              No data yet. Paste JSON and hit render.
            </div>

            <div id="snapshot-block" style="display:none;">
              <div class="section-title">Top holders snapshot</div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Address</th>
                      <th>Amount</th>
                      <th>Share%</th>
                    </tr>
                  </thead>
                  <tbody id="snapshot-table-body"></tbody>
                </table>
              </div>
            </div>

            <div id="diff-block" style="display:none; margin-top:10px;">
              <div class="section-title">Whale movements</div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>Address</th>
                      <th>Status</th>
                      <th>Rank (prev ‚Üí now)</th>
                      <th>Œî Amount</th>
                      <th>Œî Share%</th>
                    </tr>
                  </thead>
                  <tbody id="diff-table-body"></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </main>

      <footer class="footer">
        <div>
          Built by Kevin Smits (<code>@smitskecbs</code>) ‚Äì whale intel powered by solana-tools.
        </div>
        <div class="footer-right">
          <span>Telegram:</span>
          <span class="tg-pill">
            <span class="icon">üì®</span>
            <span>@smitske</span>
          </span>
        </div>
      </footer>
    </div>
  </div>

  <script>
    const jsonInput = document.getElementById("json-input");
    const parseButton = document.getElementById("parse-button");
    const statusDot = document.getElementById("status-dot");
    const statusText = document.getElementById("status-text");
    const logEl = document.getElementById("log");

    const snapshotMetaEl = document.getElementById("snapshot-meta");
    const snapshotBlock = document.getElementById("snapshot-block");
    const snapshotTbody = document.getElementById("snapshot-table-body");

    const diffBlock = document.getElementById("diff-block");
    const diffTbody = document.getElementById("diff-table-body");

    function setStatus(text, mode = "idle") {
      statusText.textContent = text;
      statusDot.classList.remove("ok", "error");
      if (mode === "ok") statusDot.classList.add("ok");
      if (mode === "error") statusDot.classList.add("error");
    }

    function setLog(text, isError = false) {
      logEl.textContent = text;
      logEl.classList.toggle("error", isError);
    }

    function shorten(addr, len = 4) {
      if (!addr || typeof addr !== "string") return String(addr || "");
      if (addr.length <= len * 2 + 3) return addr;
      return addr.slice(0, len) + "..." + addr.slice(-len);
    }

    function formatNumber(x, digits = 2) {
      if (x == null || Number.isNaN(x)) return "-";
      return x.toLocaleString(undefined, {
        maximumFractionDigits: digits
      });
    }

    function badgeClass(status) {
      switch (status) {
        case "new":
          return "badge new";
        case "gone":
          return "badge gone";
        case "increased":
          return "badge up";
        case "decreased":
          return "badge down";
        case "unchanged":
        default:
          return "badge flat";
      }
    }

    function badgeLabel(status) {
      switch (status) {
        case "new":
          return "NEW";
        case "gone":
          return "GONE";
        case "increased":
          return "UP";
        case "decreased":
          return "DOWN";
        case "unchanged":
        default:
          return "FLAT";
      }
    }

    function renderSnapshot(snapshot) {
      if (!snapshot || !snapshot.holders) {
        snapshotMetaEl.textContent = "No snapshot data in JSON.";
        snapshotMetaEl.classList.add("muted");
        snapshotBlock.style.display = "none";
        return;
      }

      const ts = snapshot.fetchedAt || "-";
      const mint = snapshot.mint || "-";
      const total = snapshot.totalSupplyUi != null
        ? formatNumber(snapshot.totalSupplyUi, 4)
        : "unknown";

      snapshotMetaEl.innerHTML =
        `Mint: <strong>${mint}</strong> &nbsp;‚Ä¢&nbsp; ` +
        `Snapshot: <strong>${ts}</strong> &nbsp;‚Ä¢&nbsp; ` +
        `Total supply (UI): <strong>${total}</strong>`;
      snapshotMetaEl.classList.remove("muted");

      snapshotTbody.innerHTML = "";
      snapshot.holders.forEach((h) => {
        const tr = document.createElement("tr");

        const rankTd = document.createElement("td");
        rankTd.textContent = h.rank != null ? h.rank : "";
        tr.appendChild(rankTd);

        const addrTd = document.createElement("td");
        addrTd.textContent = shorten(h.address);
        addrTd.className = "addr";
        tr.appendChild(addrTd);

        const amtTd = document.createElement("td");
        amtTd.textContent = formatNumber(h.uiAmount, 4);
        tr.appendChild(amtTd);

        const shareTd = document.createElement("td");
        shareTd.textContent = formatNumber(h.sharePercent, 2) + "%";
        tr.appendChild(shareTd);

        snapshotTbody.appendChild(tr);
      });

      snapshotBlock.style.display = "";
    }

    function renderDiff(diff) {
      if (!diff || !Array.isArray(diff.holders) || diff.holders.length === 0) {
        diffBlock.style.display = "none";
        return;
      }

      diffTbody.innerHTML = "";

      diff.holders.forEach((h) => {
        const tr = document.createElement("tr");

        const addrTd = document.createElement("td");
        addrTd.textContent = shorten(h.address);
        addrTd.className = "addr";
        tr.appendChild(addrTd);

        const statusTd = document.createElement("td");
        const badge = document.createElement("span");
        badge.className = badgeClass(h.status);
        badge.textContent = badgeLabel(h.status);
        statusTd.appendChild(badge);
        tr.appendChild(statusTd);

        const rankTd = document.createElement("td");
        const prevRank = h.prevRank != null ? String(h.prevRank).padStart(2, " ") : "--";
        const newRank = h.newRank != null ? String(h.newRank).padStart(2, " ") : "--";
        rankTd.textContent = `${prevRank} ‚Üí ${newRank}`;
        tr.appendChild(rankTd);

        const dAmtTd = document.createElement("td");
        const dAmt = h.deltaAmount || 0;
        const signAmt = dAmt > 0 ? "+" : "";
        dAmtTd.textContent = signAmt + formatNumber(dAmt, 4);
        tr.appendChild(dAmtTd);

        const dShareTd = document.createElement("td");
        const dShare = h.deltaShare || 0;
        const signShare = dShare > 0 ? "+" : "";
        dShareTd.textContent = signShare + formatNumber(dShare, 4) + "%";
        tr.appendChild(dShareTd);

        diffTbody.appendChild(tr);
      });

      diffBlock.style.display = "";
    }

    function parseAndRender() {
      const raw = jsonInput.value.trim();
      if (!raw) {
        setStatus("No JSON provided.", "error");
        setLog("Paste the JSON content of your snapshot file first.", true);
        snapshotMetaEl.textContent = "No data yet. Paste JSON and hit render.";
        snapshotMetaEl.classList.add("muted");
        snapshotBlock.style.display = "none";
        diffBlock.style.display = "none";
        return;
      }

      try {
        const parsed = JSON.parse(raw);

        const snapshot = parsed.snapshot || parsed; // allow dumping just snapshot
        const diff = parsed.diff || null;

        renderSnapshot(snapshot);
        renderDiff(diff);

        if (!diff) {
          setStatus("Snapshot rendered (no diff in JSON).", "ok");
          setLog("Tip: use --prev in CLI to generate diff next time.");
        } else {
          setStatus("Snapshot + diff rendered.", "ok");
          setLog("Whale movements loaded from diff.");
        }
      } catch (err) {
        console.error(err);
        setStatus("Failed to parse JSON.", "error");
        setLog("Error while parsing JSON: " + (err.message || String(err)), true);
        snapshotMetaEl.textContent = "Failed to parse JSON.";
        snapshotMetaEl.classList.add("muted");
        snapshotBlock.style.display = "none";
        diffBlock.style.display = "none";
      }
    }

    parseButton.addEventListener("click", parseAndRender);
    jsonInput.addEventListener("keydown", (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
        e.preventDefault();
        parseAndRender();
      }
    });
  </script>
</body>
</html>
